<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>碳信用交易平台</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-center text-green-600">碳信用交易平台</h1>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- 帳戶選擇 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">帳戶</h2>
                <select id="account" class="w-full p-2 border rounded">
                    <option value="admin">管理員</option>
                    <option value="user1">用戶1</option>
                    <option value="user2">用戶2</option>
                </select>
            </div>

            <!-- 餘額顯示 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">餘額</h2>
                <div class="space-y-2">
                    <p>碳信用: <span id="carbon-balance">0</span> CC</p>
                    <p>基礎貨幣: <span id="base-balance">0</span> USDC</p>
                </div>
            </div>

            <!-- 流動性池 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">流動性池</h2>
                <div class="space-y-2">
                    <p>碳信用儲備: <span id="carbon-reserves">0</span> CC</p>
                    <p>基礎貨幣儲備: <span id="base-reserves">0</span> USDC</p>
                    <p>匯率: 1 CC = <span id="exchange-rate">0</span> USDC</p>
                </div>
            </div>

            <!-- 交易操作 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">交易</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block mb-2">滑點容忍度 (%)</label>
                        <input type="number" id="slippage" value="1" min="0" max="10" class="w-full p-2 border rounded">
                    </div>
                    <div>
                        <label class="block mb-2">數量</label>
                        <input type="number" id="amount" class="w-full p-2 border rounded">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button id="swap-carbon-for-base" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">
                            用碳信用換基礎貨幣
                        </button>
                        <button id="swap-base-for-carbon" class="bg-green-500 text-white p-2 rounded hover:bg-green-600">
                            用基礎貨幣換碳信用
                        </button>
                    </div>
                </div>
            </div>

            <!-- 流動性操作 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">流動性</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block mb-2">數量 (USDC)</label>
                        <input type="number" id="liquidity-amount" class="w-full p-2 border rounded">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button id="add-liquidity" class="bg-blue-500 text-white p-2 rounded hover:bg-blue-600">
                            添加流動性
                        </button>
                        <button id="remove-liquidity" class="bg-red-500 text-white p-2 rounded hover:bg-red-600">
                            移除流動性
                        </button>
                    </div>
                </div>
            </div>

            <!-- 管理員操作 -->
            <div class="bg-white p-6 rounded-lg shadow">
                <h2 class="text-xl font-semibold mb-4">管理員操作</h2>
                <div class="space-y-4">
                    <div>
                        <label class="block mb-2">鑄造數量</label>
                        <input type="number" id="mint-amount" class="w-full p-2 border rounded">
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button id="mint" class="bg-purple-500 text-white p-2 rounded hover:bg-purple-600">
                            鑄造碳信用
                        </button>
                        <button id="disable-minting" class="bg-purple-500 text-white p-2 rounded hover:bg-purple-600">
                            禁用鑄造
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 更新餘額
        async function updateBalances() {
            const account = document.getElementById('account').value;
            const carbonBalance = await fetch(`/api/token/balance?address=${account}`).then(r => r.json());
            document.getElementById('carbon-balance').textContent = carbonBalance;
            // 基礎貨幣餘額需要從其他地方獲取
        }

        // 更新流動性池信息
        async function updatePoolInfo() {
            const reserves = await fetch('/api/exchange/liquidity?address=pool').then(r => r.json());
            document.getElementById('carbon-reserves').textContent = reserves.carbon;
            document.getElementById('base-reserves').textContent = reserves.base;
            const rate = await fetch('/api/exchange/exchange-rate').then(r => r.json());
            document.getElementById('exchange-rate').textContent = rate;
        }

        // 交易操作
        document.getElementById('swap-carbon-for-base').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            const amount = document.getElementById('amount').value;
            const slippage = document.getElementById('slippage').value;
            await fetch(`/api/exchange/swap-carbon-for-base?trader=${account}&amountCarbonCredits=${amount}&maxExchangeRate=${slippage}`, {
                method: 'POST'
            });
            updateBalances();
            updatePoolInfo();
        });

        document.getElementById('swap-base-for-carbon').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            const amount = document.getElementById('amount').value;
            const slippage = document.getElementById('slippage').value;
            await fetch(`/api/exchange/swap-base-for-carbon?trader=${account}&amountBaseCurrency=${amount}&maxExchangeRate=${slippage}`, {
                method: 'POST'
            });
            updateBalances();
            updatePoolInfo();
        });

        // 流動性操作
        document.getElementById('add-liquidity').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            const amount = document.getElementById('liquidity-amount').value;
            const slippage = document.getElementById('slippage').value;
            await fetch(`/api/exchange/add-liquidity?provider=${account}&amountBaseCurrency=${amount}&minExchangeRate=${slippage}&maxExchangeRate=${slippage}`, {
                method: 'POST'
            });
            updateBalances();
            updatePoolInfo();
        });

        document.getElementById('remove-liquidity').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            const amount = document.getElementById('liquidity-amount').value;
            const slippage = document.getElementById('slippage').value;
            await fetch(`/api/exchange/remove-liquidity?provider=${account}&amountBaseCurrency=${amount}&minExchangeRate=${slippage}&maxExchangeRate=${slippage}`, {
                method: 'POST'
            });
            updateBalances();
            updatePoolInfo();
        });

        // 管理員操作
        document.getElementById('mint').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            const amount = document.getElementById('mint-amount').value;
            await fetch(`/api/token/mint?adminAddress=${account}&to=${account}&amount=${amount}`, {
                method: 'POST'
            });
            updateBalances();
        });

        document.getElementById('disable-minting').addEventListener('click', async () => {
            const account = document.getElementById('account').value;
            await fetch(`/api/token/disable-minting?adminAddress=${account}`, {
                method: 'POST'
            });
        });

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            updateBalances();
            updatePoolInfo();
        });
    </script>
</body>
</html> 